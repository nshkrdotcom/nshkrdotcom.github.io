{{ define "main" }}
<div class="container">

  <!-- Hero -->
  <section class="hero">
    <h1 class="hero-title">North Shore Hackerspace</h1>
    <p class="hero-subtitle">Cultivating tomorrow's intelligent systems with island wisdom and BEAM excellence. Open-source AI/ML tools, security architecture, and blockchain innovation.</p>
    <div class="hero-actions">
      <a href="https://github.com/nshkrdotcom" class="btn btn-primary" target="_blank" rel="noopener">GitHub</a>
      <a href="/blog/" class="btn">Blog</a>
      <a href="/ecosystem/" class="btn">Ecosystem</a>
    </div>
  </section>

  <!-- Stats -->
  {{ $totalRepos := 0 }}
  {{ $totalStars := 0 }}
  {{ $totalCats := 0 }}
  {{ range $name, $repo := $.Site.Data.repos.repos }}
    {{ $totalRepos = add $totalRepos 1 }}
    {{ $totalStars = add $totalStars (default 0 $repo.stars) }}
  {{ end }}
  {{ range $slug, $info := $.Site.Data.repos.categories }}
    {{ $totalCats = add $totalCats 1 }}
  {{ end }}
  <div class="stats-bar">
    <div class="stat">
      <div class="stat-value">{{ $totalRepos }}</div>
      <div class="stat-label">Repositories</div>
    </div>
    <div class="stat">
      <div class="stat-value">{{ $totalStars }}</div>
      <div class="stat-label">Stars</div>
    </div>
    <div class="stat">
      <div class="stat-value">{{ $totalCats }}</div>
      <div class="stat-label">Categories</div>
    </div>
    <div class="stat">
      <div class="stat-value">&lt;100ms</div>
      <div class="stat-label">p99 Latency</div>
    </div>
  </div>

  <!-- Project Grid by Category -->
  {{ $catList := slice }}
  {{ range $slug, $info := $.Site.Data.repos.categories }}
    {{ $catList = $catList | append (dict "slug" $slug "name" $info.name "weight" (default 999 $info.weight)) }}
  {{ end }}
  {{ range $catInfo := sort $catList "weight" }}
    {{ $catSlug := $catInfo.slug }}
    {{ $catRepos := slice }}
    {{ range $name, $repo := $.Site.Data.repos.repos }}
      {{ if eq $repo.category $catSlug }}
        {{ $catRepos = $catRepos | append $repo }}
      {{ end }}
    {{ end }}

    {{ if gt (len $catRepos) 0 }}
      {{ $catRepos = sort $catRepos "stars" "desc" }}

      <section class="section">
        <h2 class="section-title">{{ $catInfo.name }}</h2>

        {{ if eq $catSlug "nshkr-crucible" }}
        <p class="section-subtitle">A platform for conducting reproducible experiments on large language model reliability, built on Elixir/OTP.</p>
        <div class="tech-stack">
          <span class="tech-tag">Elixir</span>
          <span class="tech-tag">OTP</span>
          <span class="tech-tag">BEAM VM</span>
          <span class="tech-tag">Statistical Testing</span>
          <span class="tech-tag">Ensemble Methods</span>
        </div>
        {{ end }}

        <div class="projects-grid">
          {{ range $repo := $catRepos }}
            {{ partial "project-card.html" $repo }}
          {{ end }}
        </div>
      </section>
    {{ end }}
  {{ end }}

</div>
{{ end }}
